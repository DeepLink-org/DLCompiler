diff --git a/include/triton/Dialect/Triton/IR/TritonOps.td b/include/triton/Dialect/Triton/IR/TritonOps.td
index e9f892da0..38ec0b277 100644
--- a/include/triton/Dialect/Triton/IR/TritonOps.td
+++ b/include/triton/Dialect/Triton/IR/TritonOps.td
@@ -1410,5 +1410,21 @@ def TT_DescriptorScatterOp : TT_Op<"descriptor_scatter", [TT_DescriptorStoreLike
   let hasVerifier = 1;
 }
 
+def TT_AnnotationOp : TT_Op<"annotation", [Pure, MemoryEffects<[MemWrite]>]> {
+  let summary = "Annotate a tensor with key-value attribute pairs";
+  let description = [{
+    `tt.annotation` operation can be used to annotate a tensor with
+    key-value attribute pairs.
+
+    Example:
+    ```mlir
+    tt.annotation %target {key : val}
+    ```
+  }];
+  let arguments = (ins TT_Tensor:$src);
+  let assemblyFormat = [{
+    $src attr-dict `:` type($src)
+  }];
+}
 
 #endif // Triton_OPS
diff --git a/python/triton/backends/compiler.py b/python/triton/backends/compiler.py
index 9bbc5eadb..1ee43dd4e 100644
--- a/python/triton/backends/compiler.py
+++ b/python/triton/backends/compiler.py
@@ -5,6 +5,10 @@ from typing import Dict, Union
 from types import ModuleType
 
 
+class AttrsDescriptor:
+    print(f"zmz debug using dummy AttrsDescriptor")
+    pass
+
 @dataclass(frozen=True)
 class GPUTarget(object):
     # Target backend, e.g., cuda, hip
diff --git a/python/triton/compiler/compiler.py b/python/triton/compiler/compiler.py
index 81d7b3267..3170459b0 100644
--- a/python/triton/compiler/compiler.py
+++ b/python/triton/compiler/compiler.py
@@ -15,6 +15,7 @@ import re
 import functools
 import os
 import time
+import sys
 
 # - ^\s*tt\.func\s+ : match the start of the string, any leading whitespace, the keyword func,
 #    and any following whitespace
@@ -463,8 +464,10 @@ class CompiledKernel:
         if knobs.runtime.kernel_load_start_hook is not None:
             knobs.runtime.kernel_load_start_hook(self.module, self.function, self.name, self.metadata_group, self.hash)
         # TODO: n_regs, n_spills should be metadata generated when calling `ptxas`
-        self.module, self.function, self.n_regs, self.n_spills, self.n_max_threads = driver.active.utils.load_binary(
+        # self.module, self.function, self.n_regs, self.n_spills, self.n_max_threads = driver.active.utils.load_binary(
+        self.module, self.function, self.n_regs, self.n_spills = driver.active.utils.load_binary(
             self.name, self.kernel, self.metadata.shared, device)
+        self.n_max_threads = sys.maxsize
         warp_size = driver.active.get_current_target().warp_size
         if self.metadata.num_warps * warp_size > self.n_max_threads:
             raise_(OutOfResources(self.metadata.num_warps * warp_size, self.n_max_threads, "threads"))
diff --git a/setup.py b/setup.py
index dffc45ab1..8de405b57 100644
--- a/setup.py
+++ b/setup.py
@@ -182,6 +182,13 @@ class Package:
 # json
 def get_json_package_info():
     url = "https://github.com/nlohmann/json/releases/download/v3.11.3/include.zip"
+    local_json_path = os.environ.get("JSON_PATH34", "")
+    if local_json_path != "":
+        if os.path.exists(local_json_path):
+            url = "file://" + local_json_path
+            print(f"JSON_PATH34 {local_json_path} exists. url={url}")
+        else:
+            print(f"JSON_PATH34 {local_json_path} does not exist.")
     return Package("json", "", url, "JSON_INCLUDE_DIR", "", "JSON_SYSPATH")
 
 
@@ -244,6 +251,13 @@ def get_llvm_package_info():
     # Create a stable symlink that doesn't include revision
     sym_name = f"llvm-{system_suffix}"
     url = f"https://oaitriton.blob.core.windows.net/public/llvm-builds/{name}.tar.gz"
+    local_llvm_tgz_path = os.environ.get("LLVM_TGZ_PATH34", "")
+    if local_llvm_tgz_path != "":
+        if os.path.exists(local_llvm_tgz_path):
+            url = "file://" + local_llvm_tgz_path
+            print(f"LLVM_TGZ_PATH34 {local_llvm_tgz_path} exists. url={url}")
+        else:
+            print(f"LLVM_TGZ_PATH34 {local_llvm_tgz_path} does not exist.")
     return Package("llvm", name, url, "LLVM_INCLUDE_DIRS", "LLVM_LIBRARY_DIR", "LLVM_SYSPATH", sym_name=sym_name)
 
 
@@ -528,6 +542,17 @@ class CMakeBuild(build_ext):
         subprocess.check_call(["cmake", "--build", "."] + build_args, cwd=cmake_dir)
         subprocess.check_call(["cmake", "--build", ".", "--target", "mlir-doc"], cwd=cmake_dir)
 
+        cmake_build_dir = get_cmake_dir()
+        opt_dir = os.path.join(
+            cmake_build_dir,
+            "third_party/dicp_triton/third_party/triton_shared/tools/triton-shared-opt"
+        )
+
+        shutil.copy(
+            os.path.join(opt_dir, "triton-shared-opt"),
+            os.path.join(cmake_build_dir, "../../../")
+        )
+
 
 def download_and_copy_dependencies():
     nvidia_version_path = os.path.join(get_base_dir(), "cmake", "nvidia-toolchain-version.json")
@@ -649,6 +674,9 @@ def get_packages():
             # Install the contents of each backend's `tools` directory into
             # `triton.tools.extra`.
             for x in os.listdir(backend.tools_dir):
+                if x == "CMakeLists.txt":
+                    print(f"get_packages: skipping package for CMakeLists.txt: {x}", file=sys.stderr)
+                    continue
                 yield f"triton.tools.extra.{x}"
 
     if check_env_flag("TRITON_BUILD_PROTON", "ON"):  # Default ON
diff --git a/unittest/googletest.cmake b/unittest/googletest.cmake
index 064dc8860..4ba22f32a 100644
--- a/unittest/googletest.cmake
+++ b/unittest/googletest.cmake
@@ -1,6 +1,13 @@
 include(FetchContent)
 
-set(GOOGLETEST_DIR "" CACHE STRING "Location of local GoogleTest repo to build against")
+if(DEFINED ENV{GOOGLETEST_DIR34})
+    set(GOOGLETEST_DIR $ENV{GOOGLETEST_DIR34})
+else()
+    set(GOOGLETEST_DIR "")
+endif()
+
+# set(GOOGLETEST_DIR "" CACHE STRING "Location of local GoogleTest repo to build against")
+message(STATUS "GOOGLETEST_DIR: ${GOOGLETEST_DIR}")
 
 if(GOOGLETEST_DIR)
   set(FETCHCONTENT_SOURCE_DIR_GOOGLETEST ${GOOGLETEST_DIR} CACHE STRING "GoogleTest source directory override")
@@ -8,7 +15,8 @@ endif()
 
 FetchContent_Declare(
   googletest
-  GIT_REPOSITORY https://github.com/google/googletest.git
+  # GIT_REPOSITORY https://github.com/google/googletest.git
+  GIT_REPOSITORY git@github.com:google/googletest.git
   GIT_TAG v1.17.0
   )
 
